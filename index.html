<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –£–¢–û</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 0 20px 20px; }
        .container { max-width: 1400px; margin: 130px auto 20px; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; transition: margin-top 0.3s ease; }
        .container.with-notification { margin-top: 170px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 20px; text-align: center; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .header-content { max-width: 1400px; margin: 0 auto; position: relative; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 300; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        
        /* –ö–Ω–æ–ø–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ */
        .help-btn { position: absolute; top: 0; right: 0; background: rgba(255,255,255,0.2); color: white; padding: 12px 20px; border-radius: 50px; text-decoration: none; transition: all 0.3s ease; cursor: pointer; border: none; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        .help-btn:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        
        /* Overlay –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .instruction-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: none; overflow-y: auto; }
        .instruction-overlay.show { display: block; animation: fadeIn 0.3s ease; }
        .instruction-container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        .instruction-card { background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); overflow: hidden; margin-bottom: 20px; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .instruction-header { color: white; text-align: center; padding: 40px 20px; position: relative; overflow: hidden; }
        .instruction-header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>') repeat; opacity: 0.3; animation: float 20s ease-in-out infinite; }
        .instruction-header h1 { font-size: 3rem; margin-bottom: 10px; font-weight: 300; position: relative; z-index: 2; }
        .instruction-header p { font-size: 1.3rem; opacity: 0.9; position: relative; z-index: 2; }
        .close-btn { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white; padding: 12px 20px; border-radius: 50px; text-decoration: none; transition: all 0.3s ease; z-index: 3; cursor: pointer; border: none; }
        .close-btn:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ç–∞–±–æ–≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .tab-navigation { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tab-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .tab-btn { background: #f8f9fa; color: #6c757d; border: none; padding: 15px 25px; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .tab-btn:hover { background: #e9ecef; transform: translateY(-2px); }
        .tab-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .tab-content { display: none; animation: fadeInTab 0.5s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeInTab { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* –°–µ–∫—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π */
        .instruction-section { background: white; border-radius: 15px; padding: 30px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .section-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .section-icon { width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; }
        .section-title { font-size: 1.8rem; font-weight: 600; color: #333; }
        
        /* –®–∞–≥–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π */
        .steps-container { display: grid; gap: 20px; }
        .step-item { background: #f8f9ff; border: 2px solid #e9ecef; border-radius: 15px; padding: 25px; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .step-item:hover { border-color: #667eea; transform: translateY(-5px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15); }
        .step-item::before { content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .step-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .step-number { width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; }
        .step-title { font-size: 1.2rem; font-weight: 600; color: #333; }
        .step-description { color: #6c757d; line-height: 1.6; margin-bottom: 15px; }
        .step-tips { background: #e8f4fd; border: 1px solid #b8daff; border-radius: 10px; padding: 15px; margin-top: 15px; }
        .step-tips h5 { color: #0c5460; margin-bottom: 8px; font-weight: 600; }
        .step-tips ul { list-style: none; }
        .step-tips li { color: #0c5460; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .step-tips li::before { content: '‚úì'; color: #28a745; font-weight: bold; }
        
        /* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ */
        .demo-block { background: linear-gradient(135deg, #f8f9ff 0%, #e9ecef 100%); border-radius: 15px; padding: 20px; margin: 15px 0; border: 2px dashed #667eea; position: relative; }
        .demo-label { position: absolute; top: -12px; left: 20px; background: #667eea; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; }
        .demo-content { display: flex; align-items: center; gap: 15px; }
        .demo-icon { font-size: 2rem; color: #667eea; }
        .demo-text { flex: 1; }
        
        /* FAQ —Å–µ–∫—Ü–∏—è */
        .faq-item { background: white; border: 1px solid #e9ecef; border-radius: 10px; margin-bottom: 10px; overflow: hidden; transition: all 0.3s ease; }
        .faq-item:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .faq-question { background: #f8f9fa; padding: 20px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: all 0.3s ease; }
        .faq-question:hover { background: #e9ecef; }
        .faq-question.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .faq-icon { font-size: 1.2rem; }
        .faq-text { flex: 1; font-weight: 600; }
        .faq-toggle { font-size: 1.2rem; transition: transform 0.3s ease; }
        .faq-question.active .faq-toggle { transform: rotate(180deg); }
        .faq-answer { padding: 0 20px; max-height: 0; overflow: hidden; transition: all 0.3s ease; }
        .faq-answer.active { padding: 20px; max-height: 200px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π */
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .feature-card { background: white; border-radius: 15px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .feature-card:hover { transform: translateY(-10px); box-shadow: 0 15px 35px rgba(102, 126, 234, 0.15); }
        .feature-icon { width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; }
        .feature-title { font-size: 1.3rem; font-weight: 600; color: #333; margin-bottom: 15px; }
        .feature-description { color: #6c757d; line-height: 1.6; }
        
        /* –ê–ª–µ—Ä—Ç—ã */
        .alert { padding: 15px 20px; border-radius: 10px; margin: 15px 0; display: flex; align-items: center; gap: 12px; }
        .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .alert-icon { font-size: 1.2rem; }
        
        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border: none; border-radius: 50px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .action-btn:active { transform: translateY(0); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ */
        .loading-notification { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; z-index: 9999; box-shadow: 0 2px 10px rgba(0,0,0,0.2); transform: translateY(-100%); transition: transform 0.3s ease; }
        .loading-notification.show { transform: translateY(0); }
        .loading-notification-content { max-width: 1400px; margin: 0 auto; padding: 15px 20px; display: flex; align-items: center; gap: 15px; }
        .loading-spinner { width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; }
        .loading-text { flex: 1; font-weight: 600; font-size: 1rem; }
        .loading-progress { width: 200px; }
        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #28a745, #20c997); border-radius: 2px; width: 0%; transition: width 0.3s ease; }
        
        .search-section { padding: 40px; background: #f8f9fa; }
        .file-upload-section, .advanced-search { background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e9ecef; }
        .upload-row, .search-row { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .upload-section, .search-field { display: flex; flex-direction: column; gap: 15px; }
        .upload-area { border: 2px dashed #667eea; border-radius: 12px; padding: 40px 20px; text-align: center; background: #f8f9ff; cursor: pointer; transition: all 0.3s ease; position: relative; }
        .upload-area:hover { border-color: #5a6fd8; background: #f0f2ff; }
        .upload-area.dragover { border-color: #28a745; background: #f0f9f0; transform: scale(1.02); }
        .upload-icon { font-size: 3rem; margin-bottom: 15px; opacity: 0.7; }
        .upload-text strong { display: block; font-size: 1.2rem; color: #333; margin-bottom: 8px; }
        .upload-text p { color: #6c757d; font-size: 0.9rem; margin: 0; }
        .upload-btn, .search-btn, .clear-btn, .reset-btn, .clear-data-btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .upload-btn, .search-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .clear-data-btn { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; }
        .upload-status { padding: 15px; border-radius: 8px; text-align: center; font-weight: 600; margin-top: 15px; }
        .upload-status.success { background: #d4edda; color: #155724; }
        .upload-status.error { background: #f8d7da; color: #721c24; }
        .upload-status.loading { background: #d1ecf1; color: #0c5460; }
        .upload-status.warning { background: #fff3cd; color: #856404; }
        .search-field label { font-size: 0.9rem; font-weight: 600; color: #495057; margin-bottom: 8px; }
        .search-select, .search-input { padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease; }
        .search-select:focus, .search-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .search-select:disabled, .search-input:disabled { background-color: #f8f9fa; color: #6c757d; cursor: not-allowed; border-color: #dee2e6; }
        .search-select:disabled:focus, .search-input:disabled:focus { border-color: #dee2e6; box-shadow: none; }
        
        .search-disabled-notice { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px; display: flex; align-items: center; }
        .search-disabled-notice.hidden { display: none; }
        .notice-content { display: flex; align-items: center; gap: 10px; color: #856404; font-weight: 500; }
        .notice-content i { font-size: 1.1rem; }
        
        .search-btn:disabled, .clear-btn:disabled { background: #6c757d; cursor: not-allowed; opacity: 0.6; }
        .search-btn:disabled:hover, .clear-btn:disabled:hover { background: #6c757d; transform: none; }
        .search-container { display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; }
        .clear-btn { background: #6c757d; color: white; }
        .reset-btn { background: #ffc107; color: #212529; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .stat-number { font-size: 2rem; font-weight: 700; color: #667eea; }
        .stat-label { color: #6c757d; font-size: 0.9rem; margin-top: 5px; }
        .results-section { padding: 0 40px 40px; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .results-title { font-size: 1.5rem; color: #333; font-weight: 600; }
        .export-buttons { display: flex; gap: 15px; }
        .export-btn { padding: 12px 24px; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; transition: all 0.3s ease; }
        .excel-btn { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .csv-btn { background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%); }
        .moyoffice-btn { background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%); }
        .compact-btn { background: linear-gradient(135deg, #6f42c1 0%, #007bff 100%); }
        .result-card { background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; margin-bottom: 20px; transition: all 0.3s ease; }
        .result-card:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .position-title { font-size: 1.3rem; font-weight: 600; color: #333; margin-bottom: 15px; }
        .result-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .detail-item { display: flex; flex-direction: column; }
        .detail-label { font-size: 0.85rem; color: #6c757d; font-weight: 600; margin-bottom: 5px; text-transform: uppercase; }
        .detail-value { font-size: 1rem; color: #333; word-break: break-word; }
        .department-path { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; margin-top: 15px; }
        .department-levels { background: #d4edda; border-left-color: #28a745; }
        .comment-section { background: #d1ecf1; border-left-color: #17a2b8; }
        .notes-section { background: #fff3cd; border-left-color: #ffc107; }
        .no-results { text-align: center; padding: 60px 20px; color: #6c757d; }
        .loading { text-align: center; padding: 40px; color: #667eea; font-size: 1.2rem; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .initial-message { text-align: center; padding: 40px 20px; background: white; border-radius: 15px; border: 2px dashed #667eea; margin: 20px 0; }
        .active-filters { background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .filter-tag { display: inline-block; background: #2196f3; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; margin: 2px 5px 2px 0; }
        .data-info { background: #e8f4fd; border: 1px solid #b8daff; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .data-info h4 { color: #0c5460; margin-bottom: 10px; }
        .data-info p { color: #0c5460; margin: 0; }
        .format-info { background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .format-info h4 { color: #0c5460; margin-bottom: 10px; }
        .format-info p { color: #0c5460; margin: 0; font-size: 0.9rem; }
        .format-info.warning { background: #fff3cd; border-color: #ffeaa7; }
        .format-info.warning h4, .format-info.warning p { color: #856404; }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .instruction-header h1 { font-size: 2rem; }
            .tab-buttons { justify-content: flex-start; overflow-x: auto; }
            .feature-grid { grid-template-columns: 1fr; }
            .step-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .demo-content { flex-direction: column; text-align: center; }
            .header h1 { font-size: 2rem; }
            .help-btn { position: static; margin-top: 15px; }
            .upload-row, .search-row { grid-template-columns: 1fr; }
            .export-buttons { flex-direction: column; }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è */
        .fade-in { opacity: 0; transform: translateY(30px); transition: all 0.6s ease; }
        .fade-in.visible { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ -->
    <div id="loadingNotification" class="loading-notification" style="display: none;">
        <div class="loading-notification-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">
                <span id="loadingMessage">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...</span>
            </div>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π -->
    <div id="instructionOverlay" class="instruction-overlay">
        <div class="instruction-container">
            <div class="instruction-card">
                <div class="gradient-bg">
                    <div class="instruction-header">
                        <button class="close-btn" onclick="closeInstruction()">
                            <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                        <h1><i class="fas fa-book-open"></i> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ</h1>
                        <p>–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –£–¢–û</p>
                    </div>
                </div>

                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
                <div class="tab-navigation">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="quick-start">
                            <i class="fas fa-rocket"></i> –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
                        </button>
                        <button class="tab-btn" data-tab="file-upload">
                            <i class="fas fa-cloud-upload-alt"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
                        </button>
                        <button class="tab-btn" data-tab="search-guide">
                            <i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö
                        </button>
                        <button class="tab-btn" data-tab="export-data">
                            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                        </button>
                        <button class="tab-btn" data-tab="troubleshooting">
                            <i class="fas fa-tools"></i> –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
                        </button>
                        <button class="tab-btn" data-tab="faq">
                            <i class="fas fa-question-circle"></i> FAQ
                        </button>
                    </div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç -->
                <div class="tab-content active" id="quick-start">
                    <div class="instruction-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-play"></i>
                            </div>
                            <h2 class="section-title">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h2>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle alert-icon"></i>
                            <div>
                                <strong>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</strong> –°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –£–¢–û.
                            </div>
                        </div>

                        <div class="feature-grid">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <h3 class="feature-title">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –£–¢–û</h3>
                                <p class="feature-description">–í–∏—Ç—Ä–∏–Ω—ã –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π (A-R) –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π (A-X) –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö Excel –∏–ª–∏ CSV</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <h3 class="feature-title">2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ</h3>
                                <p class="feature-description">–°–∏—Å—Ç–µ–º–∞ –Ω–∞–π–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–µ–∂–¥—É –≤–∏—Ç—Ä–∏–Ω–∞–º–∏ –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –ø–æ —Å–∏—Å—Ç–µ–º–Ω—ã–º –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è–º</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <h3 class="feature-title">3. –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑</h3>
                                <p class="feature-description">–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º, –±–ª–æ–∫–∞–º —Ñ—É–Ω–∫—Ü–∏–π, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
                <div class="tab-content" id="file-upload">
                    <div class="instruction-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h2 class="section-title">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –£–¢–û</h2>
                        </div>

                        <div class="steps-container">
                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üìä</div>
                                    <h3 class="step-title">–í–∏—Ç—Ä–∏–Ω—ã –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</h3>
                                </div>
                                <p class="step-description">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏—Ç—Ä–∏–Ω –£–¢–û (–∫–æ–ª–æ–Ω–∫–∏ A-R):</p>
                                
                                <div class="step-tips">
                                    <h5><i class="fas fa-table"></i> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫:</h5>
                                    <ul>
                                        <li>A: –ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏</li>
                                        <li>B: –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å (–ö–¶/–§–∏–ª–∏–∞–ª/–û–¶–û)</li>
                                        <li>C-L: –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (10 —É—Ä–æ–≤–Ω–µ–π)</li>
                                        <li>M: –î–æ–ª–∂–Ω–æ—Å—Ç—å</li>
                                        <li>N: –û–ö–ó</li>
                                        <li>O: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</li>
                                        <li>P-R: –ü—Ä–∏–º–µ—á–∞–Ω–∏—è</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üìã</div>
                                    <h3 class="step-title">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</h3>
                                </div>
                                <p class="step-description">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:</p>
                                
                                <div class="step-tips">
                                    <h5><i class="fas fa-list"></i> –ö–ª—é—á–µ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:</h5>
                                    <ul>
                                        <li>B: –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è</li>
                                        <li>G: –°–∏—Å—Ç–µ–º–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</li>
                                        <li>H: –ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</li>
                                        <li>Q: –ö–æ–¥ –û–ö–ó</li>
                                        <li>F: –ö–æ–¥ –û–ö–ó/–û–¢–† (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö -->
                <div class="tab-content" id="search-guide">
                    <div class="instruction-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <h2 class="section-title">–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</h2>
                        </div>

                        <div class="steps-container">
                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üéØ</div>
                                    <h3 class="step-title">–ü–æ–∏—Å–∫ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</h3>
                                </div>
                                <p class="step-description">–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.</p>
                            </div>

                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üè¢</div>
                                    <h3 class="step-title">–§–∏–ª—å—Ç—Ä –ø–æ –±–ª–æ–∫—É —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                                </div>
                                <p class="step-description">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑ –≤–∏—Ç—Ä–∏–Ω.</p>
                            </div>

                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üèõÔ∏è</div>
                                    <h3 class="step-title">–§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏</h3>
                                </div>
                                <p class="step-description">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä, –§–∏–ª–∏–∞–ª—ã –∏–ª–∏ –û–¶–û.</p>
                            </div>

                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üìÅ</div>
                                    <h3 class="step-title">–ü–æ–∏—Å–∫ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é</h3>
                                </div>
                                <p class="step-description">–ü–æ–∏—Å–∫ –ø–æ –ª—é–±–æ–º—É —É—Ä–æ–≤–Ω—é –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–æ—Ç 1 –¥–æ 10 —É—Ä–æ–≤–Ω—è).</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö -->
                <div class="tab-content" id="export-data">
                    <div class="instruction-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <h2 class="section-title">–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
                        </div>

                        <div class="feature-grid">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <h3 class="feature-title">Excel (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)</h3>
                                <p class="feature-description">–ü–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º -->
                <div class="tab-content" id="troubleshooting">
                    <div class="instruction-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <h2 class="section-title">–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º</h2>
                        </div>

                        <div class="steps-container">
                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">‚ùå</div>
                                    <h3 class="step-title">–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è</h3>
                                </div>
                                <div class="step-tips">
                                    <ul>
                                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (Excel, CSV)</li>
                                        <li>–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</li>
                                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–æ 10 –ú–ë)</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="step-item">
                                <div class="step-header">
                                    <div class="step-number">üîç</div>
                                    <h3 class="step-title">–ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π</h3>
                                </div>
                                <div class="step-tips">
                                    <ul>
                                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</li>
                                        <li>–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞</li>
                                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–æ–Ω–∫—É G –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FAQ -->
                <div class="tab-content" id="faq">
                    <div class="instruction-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <h2 class="section-title">–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
                        </div>

                        <div class="faq-container">
                            <div class="faq-item">
                                <div class="faq-question" onclick="toggleFAQ(this)">
                                    <i class="fas fa-file-import faq-icon"></i>
                                    <span class="faq-text">–ö–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?</span>
                                    <i class="fas fa-chevron-down faq-toggle"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è Excel —Ñ–∞–π–ª—ã (.xlsx, .xlsm, .xls, .ods) –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (.csv, .tsv, .txt).</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question" onclick="toggleFAQ(this)">
                                    <i class="fas fa-sync faq-icon"></i>
                                    <span class="faq-text">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö?</span>
                                    <i class="fas fa-chevron-down faq-toggle"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 5 —Å—Ç—Ä–∞—Ç–µ–≥–∏–π: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∏–º–µ–Ω–∏, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ, –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –∏ —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question" onclick="toggleFAQ(this)">
                                    <i class="fas fa-shield-alt faq-icon"></i>
                                    <span class="faq-text">–ë–µ–∑–æ–ø–∞—Å–Ω—ã –ª–∏ –º–æ–∏ –¥–∞–Ω–Ω—ã–µ?</span>
                                    <i class="fas fa-chevron-down faq-toggle"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <div class="container">
        <div class="header">
            <div class="header-content">
                <button class="help-btn" onclick="showInstruction()">
                    <i class="fas fa-question-circle"></i> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                </button>
                <h1><i class="fas fa-search"></i> –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –£–¢–û</h1>
                <p>–°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –£–¢–û</p>
            </div>
        </div>

        <div class="search-section">
            <div class="file-upload-section">
                <h3 style="margin-bottom: 20px; color: #333; font-weight: 600;"><i class="fas fa-folder-open"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –£–¢–û</h3>
                
                <div id="formatInfo" class="format-info">
                    <h4><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤</h4>
                    <p id="formatStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫...</p>
                </div>
                
                <div class="upload-container">
                    <div class="upload-row">
                        <div class="upload-section">
                            <h4><i class="fas fa-chart-bar"></i> –í–∏—Ç—Ä–∏–Ω—ã –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</h4>
                            <div class="upload-area" id="uploadAreaVitriny">
                                <div class="upload-icon"><i class="fas fa-chart-bar"></i></div>
                                <div class="upload-text">
                                    <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤–∏—Ç—Ä–∏–Ω –£–¢–û —Å—é–¥–∞</strong>
                                    <p id="supportedFormatsVitriny">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: –ø—Ä–æ–≤–µ—Ä–∫–∞...</p>
                                </div>
                                <input type="file" id="fileInputVitriny" style="display: none;">
                            </div>
                            <button class="upload-btn" id="uploadBtnVitriny"><i class="fas fa-file-upload"></i> –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –≤–∏—Ç—Ä–∏–Ω</button>
                        </div>
                        <div class="upload-section">
                            <h4><i class="fas fa-list-alt"></i> –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</h4>
                            <div class="upload-area" id="uploadAreaSprav">
                                <div class="upload-icon"><i class="fas fa-list-alt"></i></div>
                                <div class="upload-text">
                                    <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –£–¢–û —Å—é–¥–∞</strong>
                                    <p id="supportedFormatsSprav">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: –ø—Ä–æ–≤–µ—Ä–∫–∞...</p>
                                </div>
                                <input type="file" id="fileInputSprav" style="display: none;">
                            </div>
                            <button class="upload-btn" id="uploadBtnSprav"><i class="fas fa-file-upload"></i> –í—ã–±—Ä–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</button>
                        </div>
                    </div>
                    <div class="upload-actions">
                        <button class="clear-data-btn" id="clearDataBtn" style="display: none;"><i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                    </div>
                    <div id="uploadStatus" class="upload-status" style="display: none;"></div>
                </div>
            </div>

            <div class="advanced-search" id="searchSection" style="display: none;">
                <h3 style="margin-bottom: 20px; color: #333; font-weight: 600;"><i class="fas fa-search"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h3>
                
                <div id="searchDisabledNotice" class="search-disabled-notice">
                    <div class="notice-content">
                        <i class="fas fa-info-circle"></i>
                        <span id="searchDisabledText">–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –≤–∏—Ç—Ä–∏–Ω –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞</span>
                    </div>
                </div>
                
                <div class="search-row">
                    <div class="search-field">
                        <label for="blockFunction">–ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏</label>
                        <select id="blockFunction" class="search-select" disabled><option value="">-- –í—Å–µ –±–ª–æ–∫–∏ --</option></select>
                    </div>
                    <div class="search-field">
                        <label for="belonging">–ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å</label>
                        <select id="belonging" class="search-select" disabled>
                            <option value="">-- –í—Å–µ —Ç–∏–ø—ã --</option>
                            <option value="–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä</option>
                            <option value="–§–∏–ª–∏–∞–ª—ã">–§–∏–ª–∏–∞–ª—ã</option>
                            <option value="–û–¶–û">–û–¶–û</option>
                        </select>
                    </div>
                </div>
                <div class="search-row">
                    <div class="search-field">
                        <label for="department">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (–ª—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å)</label>
                        <input type="text" id="department" class="search-input" placeholder="–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏..." disabled>
                    </div>
                    <div class="search-field">
                        <label for="searchInput">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</label>
                        <input type="text" class="search-input" id="searchInput" placeholder="–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏..." disabled>
                    </div>
                </div>
            </div>

            <div class="search-container">
                <button class="search-btn" id="searchBtn" disabled><i class="fas fa-search"></i> –ü–û–ò–°–ö</button>
                <button class="clear-btn" id="clearBtn" disabled><i class="fas fa-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="reset-btn" id="resetBtn"><i class="fas fa-undo"></i> –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>

            <div id="activeFilters" class="active-filters" style="display: none;">
                <h4>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</h4>
                <div id="filtersList"></div>
            </div>

            <div class="stats">
                <div class="stat-card"><span class="stat-number" id="totalVitrinies">0</span><div class="stat-label">–ó–∞–ø–∏—Å–µ–π –≤ –≤–∏—Ç—Ä–∏–Ω–∞—Ö</div></div>
                <div class="stat-card"><span class="stat-number" id="totalPositions">0</span><div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</div></div>
                <div class="stat-card"><span class="stat-number" id="totalSprav">0</span><div class="stat-label">–ó–∞–ø–∏—Å–µ–π –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ</div></div>
                <div class="stat-card"><span class="stat-number" id="searchResults">0</span><div class="stat-label">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞</div></div>
            </div>
        </div>

        <div class="results-section">
            <div id="initialMessage" class="initial-message">
                <h3><i class="fas fa-hand-paper"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –£–¢–û!</h3>
                <p>–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –≤–∏—Ç—Ä–∏–Ω –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û. –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? <button onclick="showInstruction()" style="background: none; border: none; color: #667eea; text-decoration: underline; cursor: pointer; font-weight: 600;">–û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é</button></p>
            </div>
            <div class="results-header" id="resultsHeader" style="display: none;">
                <h2 class="results-title" id="resultsTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                <div class="export-buttons">
                    <button class="export-btn excel-btn" id="exportExcelBtn" style="display: none;"><i class="fas fa-file-excel"></i> Excel</button>
                    <button class="export-btn moyoffice-btn" id="exportMoyOfficeBtn" style="display: none;"><i class="fas fa-file-alt"></i> –ú–æ–π–û—Ñ–∏—Å</button>
                </div>
            </div>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        let vitrinyData = [];
        let spravData = [];
        let currentResults = [];
        let vitrinyLoaded = false;
        let spravLoaded = false;
        let vitrinyLoadDate = null;
        let spravLoadDate = null;
        let vitrinyFileName = '';
        let spravFileName = '';
        let xlsxAvailable = false;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        let loadingSteps = { current: 0, total: 0, messages: [] };

        // --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ù–°–¢–†–£–ö–¶–ò–ï–ô ---
        function showInstruction() {
            const overlay = document.getElementById('instructionOverlay');
            overlay.classList.add('show');
            document.body.style.overflow = 'hidden';
            console.log('üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞');
        }

        function closeInstruction() {
            const overlay = document.getElementById('instructionOverlay');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
            console.log('üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        function setupInstructionTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
                    btn.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // FAQ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω
        function toggleFAQ(element) {
            const answer = element.nextElementSibling;
            const isActive = element.classList.contains('active');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ FAQ
            document.querySelectorAll('.faq-question').forEach(q => {
                q.classList.remove('active');
                q.nextElementSibling.classList.remove('active');
            });
            
            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –±—ã–ª –∞–∫—Ç–∏–≤–Ω—ã–º, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
            if (!isActive) {
                element.classList.add('active');
                answer.classList.add('active');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
        document.addEventListener('click', (e) => {
            const overlay = document.getElementById('instructionOverlay');
            if (e.target === overlay) {
                closeInstruction();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeInstruction();
            }
        });

        // --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–û–°–¢–û–Ø–ù–ò–ï–ú –ü–û–ò–°–ö–ê ---
        function updateSearchAvailability() {
            const searchElements = {
                inputs: ['searchInput', 'department'],
                selects: ['blockFunction', 'belonging'],
                buttons: ['searchBtn', 'clearBtn'],
                notice: 'searchDisabledNotice',
                noticeText: 'searchDisabledText'
            };
            
            const isSearchEnabled = vitrinyLoaded && spravLoaded;
            const notice = document.getElementById(searchElements.notice);
            const noticeText = document.getElementById(searchElements.noticeText);
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è–º–∏ –≤–≤–æ–¥–∞
            searchElements.inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.disabled = !isSearchEnabled;
                    if (isSearchEnabled) {
                        element.placeholder = id === 'searchInput' ? '–ù–∞–ø—Ä–∏–º–µ—Ä: –≠–∫—Å–ø–µ—Ä—Ç...' : '–ù–∞–ø—Ä–∏–º–µ—Ä: –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç...';
                    } else {
                        element.placeholder = '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏...';
                        element.value = '';
                    }
                }
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
            searchElements.selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.disabled = !isSearchEnabled;
                    if (!isSearchEnabled && id === 'blockFunction') {
                        element.innerHTML = '<option value="">-- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã --</option>';
                    }
                }
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏
            searchElements.buttons.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.disabled = !isSearchEnabled;
                }
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
            if (notice && noticeText) {
                if (isSearchEnabled) {
                    notice.classList.add('hidden');
                } else {
                    notice.classList.remove('hidden');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                    if (!vitrinyLoaded && !spravLoaded) {
                        noticeText.textContent = 'üìÅ –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –≤–∏—Ç—Ä–∏–Ω –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
                    } else if (!vitrinyLoaded) {
                        noticeText.textContent = 'üìä –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤–∏—Ç—Ä–∏–Ω –£–¢–û';
                    } else if (!spravLoaded) {
                        noticeText.textContent = 'üìã –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
                    }
                }
            }
            
            console.log(`üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞: ${isSearchEnabled ? '–∞–∫—Ç–∏–≤–µ–Ω' : '–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω'} (–≤–∏—Ç—Ä–∏–Ω—ã: ${vitrinyLoaded}, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫: ${spravLoaded})`);
        }

        function enableSearchInterface() {
            updateSearchAvailability();
            if (vitrinyLoaded && spravLoaded) {
                console.log('üéâ –ü–æ–∏—Å–∫ –£–¢–û –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω - –≤—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                showUploadStatus('üîç –ü–æ–∏—Å–∫ –£–¢–û –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.', 'success');
            }
        }

        function showLoadingNotification(message, totalSteps = 1) {
            const notification = document.getElementById('loadingNotification');
            const container = document.querySelector('.container');
            const loadingMessage = document.getElementById('loadingMessage');
            const progressFill = document.getElementById('progressFill');
            
            if (!notification) return;
            
            loadingSteps.current = 0;
            loadingSteps.total = totalSteps;
            loadingSteps.messages = [];
            
            loadingMessage.textContent = message;
            progressFill.style.width = '0%';
            
            notification.classList.add('show');
            container.classList.add('with-notification');
            
            console.log(`üîÑ –ü–æ–∫–∞–∑–∞–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ: ${message}`);
        }

        function updateLoadingProgress(message, step) {
            const loadingMessage = document.getElementById('loadingMessage');
            const progressFill = document.getElementById('progressFill');
            
            if (!loadingMessage || !progressFill) return;
            
            if (step !== undefined) {
                loadingSteps.current = Math.min(step, loadingSteps.total);
            } else {
                loadingSteps.current = Math.min(loadingSteps.current + 1, loadingSteps.total);
            }
            
            const progress = (loadingSteps.current / loadingSteps.total) * 100;
            
            loadingMessage.textContent = message;
            progressFill.style.width = `${progress}%`;
            
            console.log(`üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏: ${progress.toFixed(1)}% - ${message}`);
            
            if (progress >= 100) {
                setTimeout(() => {
                    hideLoadingNotification();
                }, 1000);
            }
        }

        function hideLoadingNotification() {
            const notification = document.getElementById('loadingNotification');
            const container = document.querySelector('.container');
            
            if (!notification) return;
            
            notification.classList.remove('show');
            container.classList.remove('with-notification');
            
            loadingSteps.current = 0;
            loadingSteps.total = 0;
            loadingSteps.messages = [];
            
            console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä—ã—Ç–æ');
        }

        function showLoadingError(message) {
            const notification = document.getElementById('loadingNotification');
            const loadingMessage = document.getElementById('loadingMessage');
            
            if (!notification || !loadingMessage) return;
            
            notification.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            loadingMessage.textContent = `‚ùå ${message}`;
            
            setTimeout(() => {
                notification.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                hideLoadingNotification();
            }, 3000);
        }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –£–¢–û...');
            setupInstructionTabs();
            initializeSystem();
        });

        function initializeSystem() {
            showLoadingNotification('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –£–¢–û...', 3);
            updateLoadingProgress('–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫...', 1);
            loadXLSXLibrary();
        }

        function loadXLSXLibrary() {
            console.log('üìö –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ XLSX...');
            
            const xlsxSources = [
                'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
                'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'
            ];
            
            let sourceIndex = 0;
            
            function tryLoadSource() {
                if (sourceIndex >= xlsxSources.length) {
                    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤');
                    initializeWithoutXLSX();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = xlsxSources[sourceIndex];
                script.onload = function() {
                    console.log('‚úÖ XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑:', xlsxSources[sourceIndex]);
                    xlsxAvailable = true;
                    initializeWithXLSX();
                };
                script.onerror = function() {
                    console.warn('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑:', xlsxSources[sourceIndex]);
                    sourceIndex++;
                    tryLoadSource();
                };
                document.head.appendChild(script);
            }
            
            if (typeof XLSX !== 'undefined') {
                console.log('‚úÖ XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞');
                xlsxAvailable = true;
                initializeWithXLSX();
            } else {
                tryLoadSource();
            }
        }

        function initializeWithXLSX() {
            updateLoadingProgress('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤...', 2);
            console.log('üéâ –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –£–¢–û —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤');
            xlsxAvailable = true;
            updateFormatSupport(true);
            setTimeout(() => {
                updateLoadingProgress('–°–∏—Å—Ç–µ–º–∞ –£–¢–û –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!', 3);
                finishInitialization();
            }, 500);
        }

        function initializeWithoutXLSX() {
            updateLoadingProgress('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏...', 2);
            console.log('‚ö†Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –£–¢–û —Ç–æ–ª—å–∫–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤');
            xlsxAvailable = false;
            updateFormatSupport(false);
            setTimeout(() => {
                updateLoadingProgress('–°–∏—Å—Ç–µ–º–∞ –£–¢–û –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!', 3);
                finishInitialization();
            }, 500);
        }

        function updateFormatSupport(hasXLSX) {
            const formatInfo = document.getElementById('formatInfo');
            const formatStatus = document.getElementById('formatStatus');
            const supportedFormatsVitriny = document.getElementById('supportedFormatsVitriny');
            const supportedFormatsSprav = document.getElementById('supportedFormatsSprav');
            const fileInputVitriny = document.getElementById('fileInputVitriny');
            const fileInputSprav = document.getElementById('fileInputSprav');
            const exportExcelBtn = document.getElementById('exportExcelBtn');
            const exportMoyOfficeBtn = document.getElementById('exportMoyOfficeBtn');

            if (hasXLSX) {
                formatInfo.className = 'format-info';
                formatStatus.textContent = '‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –£–¢–û: Excel (.xlsx, .xlsm, .xls, .ods) –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (.csv, .tsv, .txt)';
                supportedFormatsVitriny.textContent = '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .xlsx, .xlsm, .xls, .ods, .csv, .tsv, .txt';
                supportedFormatsSprav.textContent = '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .xlsx, .xlsm, .xls, .ods, .csv, .tsv, .txt';
                fileInputVitriny.accept = '.xlsx,.xlsm,.xls,.ods,.csv,.tsv,.txt';
                fileInputSprav.accept = '.xlsx,.xlsm,.xls,.ods,.csv,.tsv,.txt';
                exportExcelBtn.style.display = 'inline-block';
                exportMoyOfficeBtn.style.display = 'inline-block';
            } else {
                formatInfo.className = 'format-info warning';
                formatStatus.textContent = '‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –£–¢–û: —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (.csv, .tsv, .txt). –î–ª—è Excel —Ñ–∞–π–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö –∫–∞–∫ CSV.';
                supportedFormatsVitriny.textContent = '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .csv, .tsv, .txt (–¥–ª—è Excel —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ CSV)';
                supportedFormatsSprav.textContent = '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .csv, .tsv, .txt (–¥–ª—è Excel —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ CSV)';
                fileInputVitriny.accept = '.csv,.tsv,.txt';
                fileInputSprav.accept = '.csv,.tsv,.txt';
                exportExcelBtn.style.display = 'none';
                exportMoyOfficeBtn.style.display = 'none';
            }
        }

        function finishInitialization() {
            try {
                setupFileUpload();
                setupEventListeners();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω)
                updateSearchAvailability();
                
                console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –£–¢–û –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
                setTimeout(() => {
                    showUploadStatus('üéâ –°–∏—Å—Ç–µ–º–∞ –£–¢–û –≥–æ—Ç–æ–≤–∞! –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.', 'success');
                }, 1500);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showLoadingError(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`);
            }
        }

        // --- –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ---
        function setupFileUpload() {
            const setupArea = (type) => {
                const fileInput = document.getElementById(`fileInput${type}`);
                const uploadArea = document.getElementById(`uploadArea${type}`);
                const uploadBtn = document.getElementById(`uploadBtn${type}`);
                if (!fileInput || !uploadArea || !uploadBtn) return;

                uploadArea.addEventListener('click', () => fileInput.click());
                uploadBtn.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => handleFileSelect(e, type));
                ['dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (eventName === 'dragover') uploadArea.classList.add('dragover');
                        if (eventName === 'dragleave' || eventName === 'drop') uploadArea.classList.remove('dragover');
                        if (eventName === 'drop') handleFileDrop(e, type);
                    });
                });
            };
            setupArea('Vitriny');
            setupArea('Sprav');
        }

        function setupEventListeners() {
            document.getElementById('searchBtn')?.addEventListener('click', searchPositions);
            document.getElementById('clearBtn')?.addEventListener('click', clearResults);
            document.getElementById('resetBtn')?.addEventListener('click', resetFilters);
            document.getElementById('clearDataBtn')?.addEventListener('click', clearAllData);
            document.getElementById('exportExcelBtn')?.addEventListener('click', exportToExcel);
            document.getElementById('exportMoyOfficeBtn')?.addEventListener('click', exportToMoyOffice);
            
            ['searchInput', 'department'].forEach(id => {
                const element = document.getElementById(id);
                element?.addEventListener('keypress', e => { 
                    if (e.key === 'Enter' && !element.disabled) searchPositions(); 
                });
            });
            
            ['blockFunction', 'belonging'].forEach(id => {
                const element = document.getElementById(id);
                element?.addEventListener('change', () => {
                    if (!element.disabled) searchPositions();
                });
            });
        }

        // --- –õ–û–ì–ò–ö–ê –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–û–í ---
        function handleFileSelect(event, type) {
            const file = event.target.files[0];
            if (file) {
                const fileTypeName = type === 'Vitriny' ? '–≤–∏—Ç—Ä–∏–Ω –£–¢–û' : '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
                console.log(`üìÅ –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª ${fileTypeName}: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è UX
                setTimeout(() => {
                    processFileWithNotification(file, type);
                }, 100);
            }
        }

        function handleFileDrop(event, type) {
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                const fileTypeName = type === 'Vitriny' ? '–≤–∏—Ç—Ä–∏–Ω –£–¢–û' : '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
                console.log(`üìÅ –ü–µ—Ä–µ—Ç–∞—â–µ–Ω —Ñ–∞–π–ª ${fileTypeName}: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è UX
                setTimeout(() => {
                    processFileWithNotification(file, type);
                }, 100);
            }
        }

        function processFileWithNotification(file, type) {
            const fileTypeName = type === 'Vitriny' ? '–≤–∏—Ç—Ä–∏–Ω –£–¢–û' : '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
            const fileIcon = type === 'Vitriny' ? 'üìä' : 'üìã';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å 4 —ç—Ç–∞–ø–∞–º–∏ –∏ –∏–∫–æ–Ω–∫–æ–π —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
            showLoadingNotification(`${fileIcon} –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ ${fileTypeName}...`, 4);
            
            updateLoadingProgress(`üìÅ –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ "${file.name}"...`, 1);
            
            const extension = file.name.toLowerCase().split('.').pop();
            const excelFormats = ['xlsx', 'xlsm', 'xls', 'ods'];
            const textFormats = ['csv', 'tsv', 'txt'];
            
            if (excelFormats.includes(extension) && !xlsxAvailable) {
                showLoadingError(`Excel —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∫–∞–∫ CSV.`);
                return;
            }
            
            if (!excelFormats.includes(extension) && !textFormats.includes(extension)) {
                showLoadingError(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: .${extension}`);
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    updateLoadingProgress(`‚öôÔ∏è –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –£–¢–û –∏–∑ "${file.name}"...`, 2);
                    
                    let jsonData;
                    
                    if (excelFormats.includes(extension)) {
                        const data = e.target.result;
                        
                        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –£–¢–û
                        const readOptions = {
                            type: 'array',
                            cellStyles: true,
                            cellFormulas: true,
                            cellDates: true,
                            cellNF: true,
                            sheetStubs: true,
                            dense: false,
                            raw: false,
                            dateNF: 'yyyy-mm-dd'
                        };
                        
                        // –î–ª—è ODS —Ñ–∞–π–ª–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        if (extension === 'ods') {
                            readOptions.codepage = 65001; // UTF-8
                            readOptions.cellText = false;
                            readOptions.raw = false;
                            readOptions.type = 'array';
                            console.log('üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è ODS —Ñ–∞–π–ª–∞ –£–¢–û');
                        }
                        
                        const workbook = XLSX.read(data, readOptions);
                        
                        if (!workbook.SheetNames || workbook.SheetNames.length === 0) {
                            throw new Error('–§–∞–π–ª –£–¢–û –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏—Å—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                        }
                        
                        const sheetName = workbook.SheetNames[0];
                        console.log(`üìä –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ª–∏—Å—Ç "${sheetName}" –∏–∑ —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}`);
                        
                        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
                        const convertOptions = {
                            header: 1,
                            raw: false,
                            defval: '',
                            blankrows: false,
                            dateNF: 'yyyy-mm-dd'
                        };
                        
                        if (extension === 'ods') {
                            convertOptions.raw = false;
                            convertOptions.defval = '';
                            convertOptions.blankrows = false;
                            convertOptions.cellText = false;
                            console.log('üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–ª—è ODS –£–¢–û');
                        }
                        
                        jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], convertOptions);
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ODS —Ñ–∞–π–ª–æ–≤
                        if (extension === 'ods') {
                            jsonData = jsonData.map(row => {
                                if (Array.isArray(row)) {
                                    return row.map(cell => {
                                        if (cell === null || cell === undefined) return '';
                                        return cleanString(cell.toString());
                                    });
                                }
                                return row;
                            });
                            console.log('üìä –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –£–¢–û –¥–ª—è ODS');
                        }
                        
                    } else {
                        const content = e.target.result;
                        jsonData = parseCSV(content);
                    }
                    
                    if (jsonData.length === 0) {
                        throw new Error('–§–∞–π–ª –£–¢–û –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö');
                    }
                    
                    console.log(`üìà –ü–æ–ª—É—á–µ–Ω–æ ${jsonData.length} —Å—Ç—Ä–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}: ${file.name}`);
                    updateLoadingProgress(`üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ ${jsonData.length} –∑–∞–ø–∏—Å–µ–π –£–¢–û ${fileTypeName}...`, 3);
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    setTimeout(() => {
                        try {
                            processTableDataWithNotification(jsonData, file.name, type);
                        } catch (error) {
                            showLoadingError(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}: ${error.message}`);
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}:`, error);
                    showLoadingError(`–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}: ${error.message}`);
                }
            };
            
            reader.onerror = () => {
                console.error(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}: ${file.name}`);
                showLoadingError(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –£–¢–û ${fileTypeName}`);
            };
            
            if (excelFormats.includes(extension)) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file, 'UTF-8');
            }
        }

        function processTableDataWithNotification(jsonData, fileName, type) {
            try {
                const fileTypeName = type === 'Vitriny' ? '–≤–∏—Ç—Ä–∏–Ω –£–¢–û' : '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
                
                if (type === 'Vitriny') {
                    updateLoadingProgress(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω –£–¢–û –∏–∑ "${fileName}"...`, 3);
                    vitrinyData = processVitrinyData(jsonData);
                    vitrinyLoaded = true;
                    vitrinyFileName = fileName;
                    vitrinyLoadDate = new Date();
                    console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${vitrinyData.length} –∑–∞–ø–∏—Å–µ–π –≤–∏—Ç—Ä–∏–Ω –£–¢–û –∏–∑ —Ñ–∞–π–ª–∞: ${fileName}`);
                } else {
                    updateLoadingProgress(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û –∏–∑ "${fileName}"...`, 3);
                    spravData = processSpravData(jsonData);
                    spravLoaded = true;
                    spravFileName = fileName;
                    spravLoadDate = new Date();
                    console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${spravData.length} –∑–∞–ø–∏—Å–µ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û –∏–∑ —Ñ–∞–π–ª–∞: ${fileName}`);
                }
                
                updateLoadingProgress(`‚úÖ –§–∞–π–ª –£–¢–û ${fileTypeName} "${fileName}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!`, 4);
                
                document.getElementById('searchSection').style.display = 'block';
                document.getElementById('clearDataBtn').style.display = 'inline-block';
                updateStatsDisplay();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
                updateSearchAvailability();
                
                if (vitrinyLoaded) initializeDropdowns();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–∞ —Ñ–∞–π–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                if (vitrinyLoaded && spravLoaded) {
                    setTimeout(() => {
                        showLoadingNotification('üîó –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –£–¢–û —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º...', 4);
                        updateLoadingProgress('–ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ –£–¢–û...', 1);
                        
                        // –í—ã–ø–æ–ª–Ω—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
                        performDataDiagnostics();
                        
                        // –í—ã–ø–æ–ª–Ω—è–µ–º –∞–Ω–∞–ª–∏–∑ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                        analyzeDataMatching();
                        
                        setTimeout(() => {
                            updateLoadingProgress('–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –£–¢–û...', 2);
                            setTimeout(() => {
                                updateLoadingProgress('–û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –£–¢–û...', 3);
                                enrichVitrinyWithSprav();
                                updateLoadingProgress('üéâ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –£–¢–û –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 4);
                                
                                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è
                                setTimeout(() => {
                                    enableSearchInterface();
                                }, 1000);
                            }, 800);
                        }, 600);
                    }, 1200);
                } else {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–æ–π —Ñ–∞–π–ª –µ—â–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å
                    const missingFile = !vitrinyLoaded ? '–≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û' : '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –£–¢–û';
                    setTimeout(() => {
                        showUploadStatus(`üìã –§–∞–π–ª ${fileTypeName} –∑–∞–≥—Ä—É–∂–µ–Ω. –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª ${missingFile}.`, 'success');
                    }, 1000);
                }
                
                showDataInfo();
                
            } catch (error) {
                const fileTypeName = type === 'Vitriny' ? '–≤–∏—Ç—Ä–∏–Ω –£–¢–û' : '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û';
                console.error(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}:`, error);
                showLoadingError(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ –£–¢–û ${fileTypeName}: ${error.message}`);
                
                if (type === 'Vitriny') {
                    vitrinyLoaded = false;
                    vitrinyData = [];
                } else {
                    spravLoaded = false;
                    spravData = [];
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                updateSearchAvailability();
            }
        }

        // --- –ü–ê–†–°–ò–ù–ì CSV ---
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            const result = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const delimiter = line.includes(';') ? ';' : ',';
                const cells = [];
                let currentCell = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === delimiter && !inQuotes) {
                        cells.push(currentCell.trim());
                        currentCell = '';
                    } else {
                        currentCell += char;
                    }
                }
                cells.push(currentCell.trim());
                
                const cleanedCells = cells.map(cell => cell.replace(/^"|"$/g, ''));
                result.push(cleanedCells);
            }
            
            return result;
        }

        function cleanString(str) {
            if (!str) return '';
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –∏ —É–±–∏—Ä–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            let cleaned = str.toString()
                .replace(/\u00A0/g, ' ')  // –ù–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª
                .replace(/\u2000-\u200F/g, ' ')  // –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–æ–±–µ–ª–æ–≤
                .replace(/\u202F/g, ' ')  // –£–∑–∫–∏–π –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª
                .replace(/\uFEFF/g, '')  // BOM —Å–∏–º–≤–æ–ª
                .replace(/\r\n/g, ' ')   // –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ Windows
                .replace(/\n/g, ' ')     // –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ Unix
                .replace(/\r/g, ' ')     // –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ Mac
                .replace(/\t/g, ' ')     // –¢–∞–±—É–ª—è—Ü–∏—è
                .replace(/\s+/g, ' ')    // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
                .trim();
            
            // –£–±–∏—Ä–∞–µ–º –∫–∞–≤—ã—á–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if ((cleaned.startsWith('"') && cleaned.endsWith('"')) || 
                (cleaned.startsWith("'") && cleaned.endsWith("'"))) {
                cleaned = cleaned.slice(1, -1);
            }
            
            return cleaned;
        }

        // --- –û–ë–†–ê–ë–û–¢–ö–ê –î–ê–ù–ù–´–• –í–ò–¢–†–ò–ù –£–¢–û ---
        function findColumnMapping(headers) {
            const mapping = {};
            
            console.log('üîç –ü–æ–∏—Å–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö:', headers);
            console.log('üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫:', headers.length);
            
            // –¢–æ—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û
            const exactMappings = {
                '–ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏ (–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –∫–æ–¥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π)': 'block',
                '–ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å (–ö–¶/–§–∏–ª–∏–∞–ª/–û–¶–û)': 'belonging',
                '–î–æ–ª–∂–Ω–æ—Å—Ç—å': 'position',
                '–û–ö–ó': 'okz',
                '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤': 'comment'
            };
            
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            headers.forEach((header, index) => {
                if (!header) return;
                
                const cleanHeader = cleanString(header);
                
                if (exactMappings[cleanHeader]) {
                    mapping[exactMappings[cleanHeader]] = index;
                    console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ - ${exactMappings[cleanHeader]}: –∏–Ω–¥–µ–∫—Å ${index}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${header}"`);
                }
            });
            
            // –ï—Å–ª–∏ —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
            if (Object.keys(mapping).length === 0) {
                const keywords = { 
                    block: ['–±–ª–æ–∫ —Ñ—É–Ω–∫—Ü', '—Ñ—É–Ω–∫—Ü', '–±–ª–æ–∫'], 
                    belonging: ['–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç', '–∫—Ü/—Ñ–∏–ª–∏–∞–ª', '—Ñ–∏–ª–∏–∞–ª', '–∫—Ü'], 
                    position: ['–¥–æ–ª–∂–Ω–æ—Å—Ç', '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏', '–Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏'], 
                    okz: ['–æ–∫–∑', '–∫–æ–¥ –æ–∫–∑', '–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä'], 
                    comment: ['–∫–æ–º–º–µ–Ω—Ç–∞—Ä', '—Ä–µ–∫–≤–∏–∑–∏—Ç', '–ø—Ä–∏–º–µ—á–∞–Ω'],
                    note: ['–ø—Ä–∏–º–µ—á–∞–Ω', '–∑–∞–º–µ—á–∞–Ω']
                };
                
                headers.forEach((h, i) => {
                    if (!h) return;
                    
                    const header = cleanString(h).toLowerCase();
                    console.log(`üìã –ê–Ω–∞–ª–∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û ${i}: "${h}" -> –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ: "${header}"`);
                    
                    for (const [key, keywordList] of Object.entries(keywords)) {
                        if (keywordList.some(kw => header.includes(kw.toLowerCase())) && mapping[key] === undefined) {
                            mapping[key] = i;
                            console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û ${key}: –∏–Ω–¥–µ–∫—Å ${i}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${h}"`);
                        }
                    }
                });
            }
            
            // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û
            if (headers.length > 15) {
                console.log('üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏');
                
                const standardPositions = {
                    block: 0,           // A - –ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏
                    belonging: 1,       // B - –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å
                    position: 12,       // M - –î–æ–ª–∂–Ω–æ—Å—Ç—å
                    okz: 13,           // N - –û–ö–ó
                    comment: 14,       // O - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                    note: 15           // P - –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ1
                };
                
                for (const [key, index] of Object.entries(standardPositions)) {
                    if (index < headers.length && headers[index] && !mapping[key]) {
                        mapping[key] = index;
                        console.log(`üéØ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –£–¢–û ${key}: –∏–Ω–¥–µ–∫—Å ${index}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${headers[index]}"`);
                    }
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –£–¢–û (C-L, –∏–Ω–¥–µ–∫—Å—ã 2-11)
            const departmentColumns = [];
            for (let i = 2; i <= 11; i++) {
                if (i < headers.length && headers[i]) {
                    const header = cleanString(headers[i]).toLowerCase();
                    if (header.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ') && header.includes('—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ') && header.includes('–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è')) {
                        departmentColumns.push(i);
                        console.log(`üè¢ –ù–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –£–¢–û: –∏–Ω–¥–µ–∫—Å ${i}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${headers[i]}"`);
                    }
                }
            }
            
            mapping.departmentColumns = departmentColumns;
            
            // –ü–æ–∏—Å–∫ –∫–æ–ª–æ–Ω–æ–∫ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π –£–¢–û (P, Q, R)
            const noteColumns = [];
            for (let i = 15; i <= 17; i++) {
                if (i < headers.length && headers[i]) {
                    const header = cleanString(headers[i]).toLowerCase();
                    if (header.includes('–ø—Ä–∏–º–µ—á–∞–Ω')) {
                        noteColumns.push(i);
                        console.log(`üìù –ù–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –£–¢–û: –∏–Ω–¥–µ–∫—Å ${i}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${headers[i]}"`);
                    }
                }
            }
            
            mapping.noteColumns = noteColumns;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (mapping.position === undefined) {
                console.warn('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ "position" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –≤–∏—Ç—Ä–∏–Ω–µ –£–¢–û, –ø—Ä–æ–±—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã');
                
                // –ò—â–µ–º –ª—é–±—É—é –∫–æ–ª–æ–Ω–∫—É —Å "–¥–æ–ª–∂–Ω–æ—Å—Ç—å"
                for (let i = 0; i < headers.length; i++) {
                    const header = headers[i];
                    if (header && header.toLowerCase().includes('–¥–æ–ª–∂–Ω–æ—Å—Ç')) {
                        mapping.position = i;
                        console.log(`üîÑ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ position –£–¢–û: –∏–Ω–¥–µ–∫—Å ${i}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${header}"`);
                        break;
                    }
                }
            }
            
            console.log('üìã –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:', mapping);
            return mapping;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û
        function processVitrinyData(jsonData) {
            try {
                if (!jsonData || jsonData.length < 2) {
                    throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û');
                }

                let headerRowIndex = 0;
                let dataStartIndex = 1;
                
                // –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
                console.log('üîç –ü–æ–∏—Å–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –≤–∏—Ç—Ä–∏–Ω–µ –£–¢–û...');
                
                for (let i = 0; i < Math.min(5, jsonData.length); i++) {
                    const row = jsonData[i];
                    if (!row || row.length < 10) continue;
                    
                    console.log(`üìä –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–æ–∫–∏ ${i}:`, row.slice(0, 8));
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û
                    const hasBlockFunction = row.some(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('–±–ª–æ–∫') && cellStr.includes('—Ñ—É–Ω–∫—Ü');
                    });
                    
                    const hasBelonging = row.some(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç') || (cellStr.includes('–∫—Ü') && cellStr.includes('—Ñ–∏–ª–∏–∞–ª'));
                    });
                    
                    const hasPosition = row.some(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('–¥–æ–ª–∂–Ω–æ—Å—Ç') && !cellStr.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ');
                    });
                    
                    const hasDepartments = row.filter(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ') && cellStr.includes('—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ') && cellStr.includes('–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è');
                    }).length >= 3; // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
                    
                    if ((hasBlockFunction || hasBelonging) && hasPosition && hasDepartments) {
                        headerRowIndex = i;
                        dataStartIndex = i + 1;
                        console.log(`‚úÖ –ù–∞–π–¥–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û –≤ —Å—Ç—Ä–æ–∫–µ ${i}`);
                        break;
                    }
                }

                const headers = jsonData[headerRowIndex];
                if (!headers || headers.length === 0) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Ñ–∞–π–ª–µ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û');
                }

                console.log('üìä –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:', headers);
                console.log('üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫:', headers.length);

                const mapping = findColumnMapping(headers);
                console.log('üìä –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:', mapping);
                
                if (mapping.position === undefined) {
                    console.error('‚ùå –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:', headers);
                    throw new Error('–ö–æ–ª–æ–Ω–∫–∞ "–î–æ–ª–∂–Ω–æ—Å—Ç—å" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞.');
                }
                
                const processedData = [];
                let successfulRows = 0;
                let emptyRows = 0;
                
                for (let i = dataStartIndex; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    
                    if (!row || row.length === 0) {
                        emptyRows++;
                        continue;
                    }
                    
                    const position = cleanString(row[mapping.position]);
                    if (!position) {
                        emptyRows++;
                        continue;
                    }
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –£–¢–û
                    const departmentParts = [];
                    if (mapping.departmentColumns && mapping.departmentColumns.length > 0) {
                        mapping.departmentColumns.forEach(colIndex => {
                            const dept = cleanString(row[colIndex]);
                            if (dept) {
                                departmentParts.push(dept);
                            }
                        });
                    }
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –£–¢–û
                    const notesParts = [];
                    if (mapping.noteColumns && mapping.noteColumns.length > 0) {
                        mapping.noteColumns.forEach(colIndex => {
                            const note = cleanString(row[colIndex]);
                            if (note) {
                                notesParts.push(note);
                            }
                        });
                    }
                    
                    const result = {
                        position: position,
                        systemName: '', // –í –≤–∏—Ç—Ä–∏–Ω–µ –£–¢–û –Ω–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∏–º–µ–Ω–∏, –±—É–¥–µ—Ç –æ–±–æ–≥–∞—â–µ–Ω–æ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
                        okz: cleanString(row[mapping.okz]),
                        block: cleanString(row[mapping.block]),
                        belonging: cleanString(row[mapping.belonging]),
                        department: departmentParts.join(' / '), // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
                        departmentLevels: departmentParts, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
                        comment: cleanString(row[mapping.comment]),
                        note: notesParts.join(' | '), // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
                        notes: notesParts // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
                    };
                    
                    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
                    if (successfulRows < 5) {
                        console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û ${successfulRows + 1}:`, {
                            rowIndex: i,
                            rawData: row.slice(0, 15),
                            processed: result
                        });
                    }
                    
                    processedData.push(result);
                    successfulRows++;
                }

                console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:`);
                console.log(`- –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${successfulRows}`);
                console.log(`- –ü—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–æ: ${emptyRows}`);
                console.log(`- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: ${jsonData.length}`);
                
                // –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const uniquePositions = new Set(processedData.map(item => item.position));
                const uniqueBlocks = new Set(processedData.filter(item => item.block).map(item => item.block));
                const uniqueBelongings = new Set(processedData.filter(item => item.belonging).map(item => item.belonging));
                const hasOkz = processedData.filter(item => item.okz && item.okz.trim()).length;
                const hasDepartments = processedData.filter(item => item.department && item.department.trim()).length;
                
                console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:`);
                console.log(`- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π: ${uniquePositions.size}`);
                console.log(`- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π: ${uniqueBlocks.size}`);
                console.log(`- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–µ–π: ${uniqueBelongings.size}`);
                console.log(`- –ó–∞–ø–∏—Å–µ–π —Å –û–ö–ó: ${hasOkz}`);
                console.log(`- –ó–∞–ø–∏—Å–µ–π —Å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º–∏: ${hasDepartments}`);
                
                // –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                console.log(`üìä –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:`);
                console.log(`- –ë–ª–æ–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π: ${Array.from(uniqueBlocks).slice(0, 3).join(', ')}`);
                console.log(`- –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏: ${Array.from(uniqueBelongings).join(', ')}`);
                
                const exampleWithDepartment = processedData.find(item => item.department && item.department.trim());
                if (exampleWithDepartment) {
                    console.log(`- –ü—Ä–∏–º–µ—Ä –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è: "${exampleWithDepartment.department}"`);
                }
                
                return processedData;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û:', error);
                throw error;
            }
        }

        // --- –û–ë–†–ê–ë–û–¢–ö–ê –î–ê–ù–ù–´–• –°–ü–†–ê–í–û–ß–ù–ò–ö–ê –£–¢–û ---
        function findSpravColumnMapping(headers) {
            const mapping = {};
            
            console.log('üîç –ü–æ–∏—Å–∫ –∫–æ–ª–æ–Ω–æ–∫ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö:', headers);
            
            // –¢–æ—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–∞–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û
            const exactMappings = {
                '–°–∏—Å—Ç–µ–º–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ': 'position',
                '–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ': 'fullName', 
                '–ö–æ–¥ –û–ö–ó': 'okzCode',
                '–°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è': 'systemName',
                '–ö–æ–¥ –û–ö–ó/–û–¢–†': 'okzCodeAlt'
            };
            
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            headers.forEach((header, index) => {
                if (!header) return;
                
                const cleanHeader = cleanString(header);
                
                if (exactMappings[cleanHeader]) {
                    mapping[exactMappings[cleanHeader]] = index;
                    console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ - ${exactMappings[cleanHeader]}: –∏–Ω–¥–µ–∫—Å ${index}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${header}"`);
                }
            });
            
            // –ï—Å–ª–∏ —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
            if (Object.keys(mapping).length === 0) {
                const keywords = { 
                    position: [
                        '—Å–∏—Å—Ç–µ–º–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏', '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', 
                        '–¥–æ–ª–∂–Ω–æ—Å—Ç', '–Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏', '–Ω–∞–∑–≤–∞–Ω–∏–µ', '—Å–∏—Å—Ç–µ–º–Ω –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω'
                    ], 
                    systemName: [
                        '—Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è', '—Å–∏—Å—Ç–µ–º–Ω –∏–º—è', '–∫–æ–¥ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏', '–∫–æ–¥', 
                        '—Å–∏—Å—Ç–µ–º–Ω', '–∏–º—è'
                    ], 
                    fullName: [
                        '–ø–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', '–ø–æ–ª–Ω –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω', 
                        '–ø–æ–ª–Ω', '—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–æ–ø–∏—Å–∞–Ω–∏–µ'
                    ], 
                    okzCode: [
                        '–∫–æ–¥ –æ–∫–∑', '–æ–∫–∑', '–∫–æ–¥ –æ–±—â–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞', 
                        '–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä', 'okz'
                    ],
                    okzCodeAlt: [
                        '–∫–æ–¥ –æ–∫–∑/–æ—Ç—Ä', '–æ–∫–∑/–æ—Ç—Ä', '–∫–æ–¥ –æ–∫–∑ –æ—Ç—Ä'
                    ]
                };
                
                headers.forEach((h, i) => {
                    if (!h) return;
                    
                    const header = cleanString(h).toLowerCase();
                    console.log(`üìã –ê–Ω–∞–ª–∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ ${i}: "${h}" -> –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ: "${header}"`);
                    
                    for (const [key, keywordList] of Object.entries(keywords)) {
                        if (keywordList.some(kw => header.includes(kw.toLowerCase())) && mapping[key] === undefined) {
                            mapping[key] = i;
                            console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û ${key}: –∏–Ω–¥–µ–∫—Å ${i}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${h}"`);
                        }
                    }
                });
            }
            
            // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û
            if (headers.length > 20) {
                console.log('üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏');
                
                // –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û
                const standardPositions = {
                    systemName: 1,      // B - –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è
                    okzCodeAlt: 5,      // F - –ö–æ–¥ –û–ö–ó/–û–¢–†  
                    position: 6,        // G - –°–∏—Å—Ç–µ–º–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
                    fullName: 7,        // H - –ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
                    okzCode: 16         // Q - –ö–æ–¥ –û–ö–ó
                };
                
                for (const [key, index] of Object.entries(standardPositions)) {
                    if (index < headers.length && headers[index] && !mapping[key]) {
                        mapping[key] = index;
                        console.log(`üéØ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –£–¢–û ${key}: –∏–Ω–¥–µ–∫—Å ${index}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${headers[index]}"`);
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (mapping.position === undefined) {
                console.warn('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ "position" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –£–¢–û, –ø—Ä–æ–±—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã');
                
                // –ò—â–µ–º –ª—é–±—É—é –∫–æ–ª–æ–Ω–∫—É —Å "–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ" –∏–ª–∏ "–¥–æ–ª–∂–Ω–æ—Å—Ç—å"
                for (let i = 0; i < headers.length; i++) {
                    const header = headers[i];
                    if (header && (header.toLowerCase().includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω') || header.toLowerCase().includes('–¥–æ–ª–∂–Ω–æ—Å—Ç'))) {
                        mapping.position = i;
                        console.log(`üîÑ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ position –£–¢–û: –∏–Ω–¥–µ–∫—Å ${i}, –∑–∞–≥–æ–ª–æ–≤–æ–∫ "${header}"`);
                        break;
                    }
                }
            }
            
            console.log('üìã –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:', mapping);
            return mapping;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û
        function processSpravData(jsonData) {
            try {
                if (!jsonData || jsonData.length < 2) {
                    throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û');
                }

                let headerRowIndex = 0;
                let dataStartIndex = 1;
                
                // –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
                console.log('üîç –ü–æ–∏—Å–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –£–¢–û...');
                
                for (let i = 0; i < Math.min(10, jsonData.length); i++) {
                    const row = jsonData[i];
                    if (!row || row.length < 5) continue;
                    
                    console.log(`üìã –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–æ–∫–∏ ${i}:`, row.slice(0, 8));
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û
                    const hasSystemName = row.some(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('—Å–∏—Å—Ç–µ–º–Ω–æ–µ') && (cellStr.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ') || cellStr.includes('–∏–º—è'));
                    });
                    
                    const hasOkzCode = row.some(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('–∫–æ–¥') && cellStr.includes('–æ–∫–∑');
                    });
                    
                    const hasFullName = row.some(cell => {
                        if (!cell) return false;
                        const cellStr = cell.toString().toLowerCase();
                        return cellStr.includes('–ø–æ–ª–Ω–æ–µ') && cellStr.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ');
                    });
                    
                    if (hasSystemName && (hasOkzCode || hasFullName)) {
                        headerRowIndex = i;
                        dataStartIndex = i + 1;
                        console.log(`‚úÖ –ù–∞–π–¥–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û –≤ —Å—Ç—Ä–æ–∫–µ ${i}`);
                        break;
                    }
                }

                const headers = jsonData[headerRowIndex];
                if (!headers || headers.length === 0) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Ñ–∞–π–ª–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û');
                }

                console.log('üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:', headers);
                console.log('üìã –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫:', headers.length);

                const mapping = findSpravColumnMapping(headers);
                console.log('üìã –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:', mapping);
                
                if (mapping.position === undefined) {
                    console.error('‚ùå –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:', headers);
                    throw new Error('–ö–æ–ª–æ–Ω–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –£–¢–û –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞.');
                }
                
                const processedData = [];
                let successfulRows = 0;
                let emptyRows = 0;
                
                for (let i = dataStartIndex; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    
                    if (!row || row.length === 0) {
                        emptyRows++;
                        continue;
                    }
                    
                    const position = cleanString(row[mapping.position]);
                    if (!position) {
                        emptyRows++;
                        continue;
                    }
                    
                    const result = {
                        position: position,
                        systemName: cleanString(row[mapping.systemName]),
                        fullName: cleanString(row[mapping.fullName]),
                        okzCode: cleanString(row[mapping.okzCode]) || cleanString(row[mapping.okzCodeAlt]) // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–æ–¥ –û–ö–ó
                    };
                    
                    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
                    if (successfulRows < 5) {
                        console.log(`üìã –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û ${successfulRows + 1}:`, {
                            rowIndex: i,
                            rawData: row.slice(0, 10),
                            processed: result
                        });
                    }
                    
                    processedData.push(result);
                    successfulRows++;
                }

                console.log(`üìã –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:`);
                console.log(`- –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${successfulRows}`);
                console.log(`- –ü—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–æ: ${emptyRows}`);
                console.log(`- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: ${jsonData.length}`);
                
                // –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const uniquePositions = new Set(processedData.map(item => item.position));
                const hasSystemNames = processedData.filter(item => item.systemName && item.systemName.trim()).length;
                const hasOkzCodes = processedData.filter(item => item.okzCode && item.okzCode.trim()).length;
                const hasFullNames = processedData.filter(item => item.fullName && item.fullName.trim()).length;
                
                console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:`);
                console.log(`- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π: ${uniquePositions.size}`);
                console.log(`- –ó–∞–ø–∏—Å–µ–π —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏: ${hasSystemNames}`);
                console.log(`- –ó–∞–ø–∏—Å–µ–π —Å –∫–æ–¥–∞–º–∏ –û–ö–ó: ${hasOkzCodes}`);
                console.log(`- –ó–∞–ø–∏—Å–µ–π —Å –ø–æ–ª–Ω—ã–º–∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è–º–∏: ${hasFullNames}`);
                
                // –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                const exampleWithSystemName = processedData.find(item => item.systemName && item.systemName.trim());
                const exampleWithOkz = processedData.find(item => item.okzCode && item.okzCode.trim());
                const exampleWithFullName = processedData.find(item => item.fullName && item.fullName.trim());
                
                console.log(`üìã –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:`);
                if (exampleWithSystemName) console.log(`- –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è: "${exampleWithSystemName.systemName}"`);
                if (exampleWithOkz) console.log(`- –ö–æ–¥ –û–ö–ó: "${exampleWithOkz.okzCode}"`);
                if (exampleWithFullName) console.log(`- –ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: "${exampleWithFullName.fullName}"`);
                
                return processedData;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:', error);
                throw error;
            }
        }

        // --- –û–ë–û–ì–ê–©–ï–ù–ò–ï –î–ê–ù–ù–´–• –£–¢–û ---
        function enrichVitrinyWithSprav() {
            if (!vitrinyLoaded || !spravLoaded) return;

            try {
                console.log('üîó –ù–∞—á–∏–Ω–∞–µ–º –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω –£–¢–û —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º');
                console.log(`üìä –í–∏—Ç—Ä–∏–Ω—ã –£–¢–û: ${vitrinyData.length} –∑–∞–ø–∏—Å–µ–π, –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –£–¢–û: ${spravData.length} –∑–∞–ø–∏—Å–µ–π`);
                
                // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
                const spravIndexExact = new Map();
                const spravIndexNormalized = new Map();
                const spravIndexWords = new Map();
                const spravIndexSystemName = new Map();
                const spravIndexPartial = new Map();
                
                spravData.forEach((item, index) => {
                    if (item && item.position) {
                        const originalKey = item.position.toLowerCase().trim();
                        const normalizedKey = normalizePosition(item.position);
                        const wordsKey = getPositionWords(item.position);
                        
                        spravIndexExact.set(originalKey, item);
                        spravIndexNormalized.set(normalizedKey, item);
                        
                        if (wordsKey.length > 0) {
                            spravIndexWords.set(wordsKey, item);
                        }
                        
                        // –ò–Ω–¥–µ–∫—Å –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∏–º–µ–Ω–∏
                        if (item.systemName) {
                            const systemKey = item.systemName.toLowerCase().trim();
                            spravIndexSystemName.set(systemKey, item);
                        }
                        
                        // –ò–Ω–¥–µ–∫—Å –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                        const positionWords = item.position.toLowerCase().split(' ');
                        positionWords.forEach(word => {
                            if (word.length > 3) {
                                spravIndexPartial.set(word, item);
                            }
                        });
                    }
                });

                console.log(`üìã –°–æ–∑–¥–∞–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:`);
                console.log(`- –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: ${spravIndexExact.size}`);
                console.log(`- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ: ${spravIndexNormalized.size}`);
                console.log(`- –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º: ${spravIndexWords.size}`);
                console.log(`- –ü–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∏–º–µ–Ω–∏: ${spravIndexSystemName.size}`);
                console.log(`- –ß–∞—Å—Ç–∏—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: ${spravIndexPartial.size}`);
                
                let matches = 0;
                let enrichedSystemName = 0;
                let enrichedOkz = 0;
                let enrichedFullName = 0;

                vitrinyData.forEach((item, index) => {
                    if (!item || !item.position) return;

                    let match = null;
                    let matchType = '';

                    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
                    const exactKey = item.position.toLowerCase().trim();
                    match = spravIndexExact.get(exactKey);
                    if (match) {
                        matchType = '—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ';
                    }

                    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ü–æ–∏—Å–∫ –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∏–º–µ–Ω–∏
                    if (!match && item.systemName) {
                        const systemKey = item.systemName.toLowerCase().trim();
                        match = spravIndexSystemName.get(systemKey);
                        if (match) {
                            matchType = '—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∏–º–µ–Ω–∏';
                        }
                    }

                    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                    if (!match) {
                        const normalizedKey = normalizePosition(item.position);
                        match = spravIndexNormalized.get(normalizedKey);
                        if (match) {
                            matchType = '–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ';
                        }
                    }

                    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 4: –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
                    if (!match) {
                        const wordsKey = getPositionWords(item.position);
                        if (wordsKey.length > 0) {
                            match = spravIndexWords.get(wordsKey);
                            if (match) {
                                matchType = '—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º';
                            }
                        }
                    }

                    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 5: –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ —Å–ª–æ–≤–∞–º
                    if (!match) {
                        const itemWords = item.position.toLowerCase().split(' ');
                        for (const word of itemWords) {
                            if (word.length > 3) {
                                const partialMatch = spravIndexPartial.get(word);
                                if (partialMatch) {
                                    match = partialMatch;
                                    matchType = '—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ';
                                    break;
                                }
                            }
                        }
                    }

                    if (match) {
                        matches++;
                        
                        // –û–±–æ–≥–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                        if (match.systemName && match.systemName.trim() && (!item.systemName || !item.systemName.trim())) {
                            item.systemName = match.systemName;
                            enrichedSystemName++;
                        }
                        
                        if (match.okzCode && match.okzCode.trim()) {
                            item.okz = match.okzCode;
                            enrichedOkz++;
                        }
                        
                        if (match.fullName && match.fullName.trim()) {
                            item.fullPositionName = match.fullName;
                            enrichedFullName++;
                        }
                        
                        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                        if (matches <= 10) {
                            console.log(`‚úÖ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –£–¢–û ${matches} (${matchType}): "${item.position}" -> "${match.position}"`);
                        }
                    }
                });

                console.log(`üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–æ–≥–∞—â–µ–Ω–∏—è –£–¢–û:`);
                console.log(`- –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${matches}`);
                console.log(`- –û–±–æ–≥–∞—â–µ–Ω–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–º–µ–Ω: ${enrichedSystemName}`);
                console.log(`- –û–±–æ–≥–∞—â–µ–Ω–æ –û–ö–ó: ${enrichedOkz}`);
                console.log(`- –û–±–æ–≥–∞—â–µ–Ω–æ –ø–æ–ª–Ω—ã—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π: ${enrichedFullName}`);

                const successRate = ((matches / vitrinyData.length) * 100).toFixed(1);
                
                if (matches > 0) {
                    showUploadStatus(`üîó –û–±–æ–≥–∞—â–µ–Ω–∏–µ –£–¢–û –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${matches} –∏–∑ ${vitrinyData.length} (${successRate}%). –û–±–æ–≥–∞—â–µ–Ω–æ: —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–º–µ–Ω ${enrichedSystemName}, –û–ö–ó ${enrichedOkz}, –ø–æ–ª–Ω—ã—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π ${enrichedFullName}`, 'success');
                } else {
                    showUploadStatus('‚ö†Ô∏è –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –º–µ–∂–¥—É –≤–∏—Ç—Ä–∏–Ω–∞–º–∏ –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –£–¢–û –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤.', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –£–¢–û:', error);
                showUploadStatus(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –£–¢–û: ${error.message}`, 'error');
            }
        }

        function normalizePosition(position) {
            if (!position) return '';
            
            return position
                .toLowerCase()
                .trim()
                // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –∫–∞–≤—ã—á–µ–∫ –∏ —Å–∫–æ–±–æ–∫
                .replace(/[¬´¬ª""''`¬¥]/g, '')
                // –£–±–∏—Ä–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∫—Ä–æ–º–µ –±—É–∫–≤, —Ü–∏—Ñ—Ä –∏ –ø—Ä–æ–±–µ–ª–æ–≤
                .replace(/[^\w\s\u0400-\u04FF\u0401\u0451]/g, ' ')
                // –ó–∞–º–µ–Ω—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –æ–¥–∏–Ω
                .replace(/\s+/g, ' ')
                .trim();
        }

        function getPositionWords(position) {
            if (!position) return '';
            
            const stopWords = ['–ø–æ', '–≤', '–Ω–∞', '—Å', '–¥–ª—è', '–æ—Ç', '–∫', '–∏', '–∏–ª–∏', '–∞', '–Ω–æ', '–¥–∞', '–Ω–µ—Ç', '–Ω–µ', '–∫–∞–∫', '—á—Ç–æ', '–≥–¥–µ', '–ø—Ä–∏', '–±–µ–∑', '–ø–æ–¥', '–Ω–∞–¥', '–∑–∞', '–∏–∑', '–¥–æ', '–ø–æ—Å–ª–µ', '—á–µ—Ä–µ–∑', '–º–µ–∂–¥—É'];
            
            const words = normalizePosition(position)
                .split(' ')
                .filter(word => word.length > 2 && !stopWords.includes(word))
                .sort()
                .join(' ');
            
            return words;
        }

        // --- –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–ê–ù–ù–´–• ---
        function performDataDiagnostics() {
            if (!vitrinyLoaded || !spravLoaded) return;
            
            console.log('üîç === –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–ê–ù–ù–´–• –£–¢–û ===');
            
            // –ê–Ω–∞–ª–∏–∑ –≤–∏—Ç—Ä–∏–Ω –£–¢–û
            console.log('üìä –ê–Ω–∞–ª–∏–∑ –≤–∏—Ç—Ä–∏–Ω –£–¢–û:');
            const vitrinyWithSystemName = vitrinyData.filter(item => item.systemName && item.systemName.trim()).length;
            const vitrinyWithOkz = vitrinyData.filter(item => item.okz && item.okz.trim()).length;
            const vitrinyWithFullName = vitrinyData.filter(item => item.fullPositionName && item.fullPositionName.trim()).length;
            console.log(`- –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${vitrinyData.length}`);
            console.log(`- –° —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏: ${vitrinyWithSystemName}`);
            console.log(`- –° –û–ö–ó: ${vitrinyWithOkz}`);
            console.log(`- –° –ø–æ–ª–Ω—ã–º–∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è–º–∏: ${vitrinyWithFullName}`);
            
            // –ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û
            console.log('üìã –ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –£–¢–û:');
            const spravWithSystemName = spravData.filter(item => item.systemName && item.systemName.trim()).length;
            const spravWithOkz = spravData.filter(item => item.okzCode && item.okzCode.trim()).length;
            const spravWithFullName = spravData.filter(item => item.fullName && item.fullName.trim()).length;
            console.log(`- –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${spravData.length}`);
            console.log(`- –° —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏: ${spravWithSystemName}`);
            console.log(`- –° –∫–æ–¥–∞–º–∏ –û–ö–ó: ${spravWithOkz}`);
            console.log(`- –° –ø–æ–ª–Ω—ã–º–∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è–º–∏: ${spravWithFullName}`);
            
            console.log('üîç === –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –£–¢–û ===');
        }

        function analyzeDataMatching() {
            if (!vitrinyLoaded || !spravLoaded) return;
            
            console.log('üîç === –ê–ù–ê–õ–ò–ó –°–û–ü–û–°–¢–ê–í–õ–ï–ù–ò–Ø –î–ê–ù–ù–´–• –£–¢–û ===');
            
            // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π –∏–∑ –≤–∏—Ç—Ä–∏–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
            const testItems = vitrinyData.slice(0, 5);
            
            testItems.forEach((vitrinyItem, index) => {
                console.log(`\nüìä –ê–Ω–∞–ª–∏–∑ –∑–∞–ø–∏—Å–∏ –£–¢–û ${index + 1} –∏–∑ –≤–∏—Ç—Ä–∏–Ω:`);
                console.log(`- –î–æ–ª–∂–Ω–æ—Å—Ç—å: "${vitrinyItem.position}"`);
                console.log(`- –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è: "${vitrinyItem.systemName}"`);
                console.log(`- –û–ö–ó: "${vitrinyItem.okz}"`);
                
                // –ü–æ–∏—Å–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                let foundMatches = [];
                
                // 1. –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                const exactMatch = spravData.find(spravItem => 
                    spravItem.position && spravItem.position.toLowerCase().trim() === vitrinyItem.position.toLowerCase().trim()
                );
                if (exactMatch) {
                    foundMatches.push({
                        type: '–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ',
                        match: exactMatch,
                        reason: '–ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π'
                    });
                }
                
                // 2. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                const normalizedVitriny = normalizePosition(vitrinyItem.position);
                const normalizedMatch = spravData.find(spravItem => 
                    spravItem.position && normalizePosition(spravItem.position) === normalizedVitriny
                );
                if (normalizedMatch && !foundMatches.some(m => m.match === normalizedMatch)) {
                    foundMatches.push({
                        type: '–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ',
                        match: normalizedMatch,
                        reason: `–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: "${normalizedVitriny}"`
                    });
                }
                
                // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (foundMatches.length > 0) {
                    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${foundMatches.length} –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –£–¢–û:`);
                    foundMatches.forEach((match, i) => {
                        console.log(`  ${i + 1}. ${match.type}:`);
                        console.log(`     –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: "${match.match.position}"`);
                        console.log(`     –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è: "${match.match.systemName}"`);
                        console.log(`     –û–ö–ó: "${match.match.okzCode}"`);
                        console.log(`     –ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: "${match.match.fullName}"`);
                    });
                } else {
                    console.log(`‚ùå –°–æ–≤–ø–∞–¥–µ–Ω–∏–π –£–¢–û –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
                }
            });
            
            console.log('\nüîç === –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–û–ü–û–°–¢–ê–í–õ–ï–ù–ò–Ø –£–¢–û ===');
        }

        // --- –õ–û–ì–ò–ö–ê –ü–û–ò–°–ö–ê ---
        function searchPositions() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞
            if (!vitrinyLoaded || !spravLoaded) {
                const missingFiles = [];
                if (!vitrinyLoaded) missingFiles.push('–≤–∏—Ç—Ä–∏–Ω—ã –£–¢–û');
                if (!spravLoaded) missingFiles.push('—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –£–¢–û');
                
                alert(`‚ö†Ô∏è –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã: ${missingFiles.join(' –∏ ')}`);
                console.log('‚ùå –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ –±–µ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –£–¢–û');
                return;
            }
            
            try {
                showLoadingNotification('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –£–¢–û...', 3);
                updateLoadingProgress('–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –£–¢–û...', 1);
                
                setTimeout(() => {
                    try {
                        updateLoadingProgress('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –£–¢–û...', 2);
                        
                        const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
                        const block = document.getElementById('blockFunction').value;
                        const belonging = document.getElementById('belonging').value;
                        const department = document.getElementById('department').value.trim().toLowerCase();
                        
                        currentResults = vitrinyData.filter(item => {
                            if (!item) return false;
                            
                            const matchesSearchTerm = !searchTerm || 
                                (item.position && item.position.toLowerCase().includes(searchTerm)) || 
                                (item.systemName && item.systemName.toLowerCase().includes(searchTerm));
                                
                            const matchesBlock = !block || item.block === block;
                            const matchesBelonging = !belonging || item.belonging === belonging;
                            const matchesDepartment = !department || 
                                (item.department && item.department.toLowerCase().includes(department));
                            
                            return matchesSearchTerm && matchesBlock && matchesBelonging && matchesDepartment;
                        });
                        
                        setTimeout(() => {
                            updateLoadingProgress(`–ù–∞–π–¥–µ–Ω–æ ${currentResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –£–¢–û`, 3);
                            displayResults();
                            updateStatsDisplay();
                            displayActiveFilters({searchTerm, block, belonging, department});
                        }, 300);
                        
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞ –£–¢–û:', error);
                        showLoadingError(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –£–¢–û: ${error.message}`);
                        document.getElementById('resultsContainer').innerHTML = `
                            <div class="no-results">
                                <h3><i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –£–¢–û</h3>
                                <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞: ${error.message}</p>
                            </div>`;
                    }
                }, 200);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –£–¢–û:', error);
                showLoadingError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –£–¢–û');
            }
        }

        // --- –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ---
        function displayResults() {
            const container = document.getElementById('resultsContainer');
            const header = document.getElementById('resultsHeader');
            document.getElementById('initialMessage').style.display = 'none';

            if (currentResults.length === 0) {
                container.innerHTML = `<div class="no-results"><h3><i class="fas fa-search"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –£–¢–û –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3><p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</p></div>`;
                header.style.display = 'none';
                return;
            }

            header.style.display = 'flex';
            document.getElementById('resultsTitle').textContent = `–ù–∞–π–¥–µ–Ω–æ ${currentResults.length} –∑–∞–ø–∏—Å–µ–π –£–¢–û`;
            
            container.innerHTML = currentResults.map(result => `
                <div class="result-card">
                    <div class="position-title">${result.position}</div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="detail-label">–°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è</div>
                            <div class="detail-value">${result.systemName || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</div>
                            <div class="detail-value">${result.fullPositionName || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–û–ö–ó</div>
                            <div class="detail-value">${result.okz || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏</div>
                            <div class="detail-value">${result.block || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å</div>
                            <div class="detail-value">${result.belonging || '‚Äî'}</div>
                        </div>
                    </div>
                    
                    ${result.department ? `
                        <div class="department-path">
                            <div class="detail-label">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –£–¢–û</div>
                            <div class="detail-value">${result.department}</div>
                        </div>
                    ` : ''}
                    
                    ${result.departmentLevels && result.departmentLevels.length > 0 ? `
                        <div class="department-path department-levels">
                            <div class="detail-label">–£—Ä–æ–≤–Ω–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –£–¢–û</div>
                            <div class="detail-value">
                                ${result.departmentLevels.map((level, index) => 
                                    `<div style="margin-bottom: 5px;"><strong>–£—Ä–æ–≤–µ–Ω—å ${index + 1}:</strong> ${level}</div>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${result.comment ? `
                        <div class="department-path comment-section">
                            <div class="detail-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
                            <div class="detail-value">${result.comment}</div>
                        </div>
                    ` : ''}
                    
                    ${result.note ? `
                        <div class="department-path notes-section">
                            <div class="detail-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –£–¢–û</div>
                            <div class="detail-value">${result.note}</div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        function clearResults() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏
            if (!vitrinyLoaded || !spravLoaded) {
                console.log('‚ö†Ô∏è –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –£–¢–û –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - –Ω–µ –≤—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                return;
            }
            
            currentResults = [];
            document.getElementById('resultsContainer').innerHTML = '';
            document.getElementById('resultsHeader').style.display = 'none';
            document.getElementById('initialMessage').style.display = 'block';
            updateStatsDisplay();
            
            console.log('üßπ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –£–¢–û –æ—á–∏—â–µ–Ω—ã');
        }

        function resetFilters() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –£–¢–û –∏ —Ñ–∏–ª—å—Ç—Ä—ã?')) {
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('searchInput').value = '';
            document.getElementById('department').value = '';
            document.getElementById('blockFunction').value = '';
            document.getElementById('belonging').value = '';
            
            // –í–ê–ñ–ù–û: –û—á–∏—â–∞–µ–º input —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            document.getElementById('fileInputVitriny').value = '';
            document.getElementById('fileInputSprav').value = '';
            
            // –û—á–∏—â–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –£–¢–û
            vitrinyData = [];
            spravData = [];
            vitrinyLoaded = false;
            spravLoaded = false;
            vitrinyLoadDate = null;
            spravLoadDate = null;
            vitrinyFileName = '';
            spravFileName = '';
            currentResults = [];
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –∏ –∫–Ω–æ–ø–∫–∏
            document.getElementById('searchSection').style.display = 'none';
            document.getElementById('clearDataBtn').style.display = 'none';
            
            // –û—á–∏—â–∞–µ–º UI
            displayActiveFilters({});
            clearResults();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∞–Ω–Ω—ã—Ö
            updateStatsDisplay();
            showDataInfo();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
            const blockSelect = document.getElementById('blockFunction');
            blockSelect.innerHTML = '<option value="">-- –í—Å–µ –±–ª–æ–∫–∏ --</option>';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ª—é–±—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ
            hideLoadingNotification();
            
            // –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º)
            updateSearchAvailability();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–±—Ä–æ—Å–µ
            showUploadStatus('üîÑ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –£–¢–û –∏ —Ñ–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.', 'success');
            
            console.log('üîÑ –°–∏—Å—Ç–µ–º–∞ –£–¢–û –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ');
        }
        
        function clearAllData() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –£–¢–û?')) return;
            
            // –û—á–∏—â–∞–µ–º input —Ñ–∞–π–ª–æ–≤
            document.getElementById('fileInputVitriny').value = '';
            document.getElementById('fileInputSprav').value = '';
            
            // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –£–¢–û
            vitrinyData = []; 
            spravData = [];
            vitrinyLoaded = false; 
            spravLoaded = false;
            vitrinyLoadDate = null; 
            spravLoadDate = null;
            vitrinyFileName = ''; 
            spravFileName = '';
            
            // –°–∫—Ä—ã–≤–∞–µ–º UI —ç–ª–µ–º–µ–Ω—Ç—ã
            document.getElementById('searchSection').style.display = 'none';
            document.getElementById('clearDataBtn').style.display = 'none';
            
            // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã
            clearResults();
            document.getElementById('searchInput').value = '';
            document.getElementById('department').value = '';
            document.getElementById('blockFunction').value = '';
            document.getElementById('belonging').value = '';
            displayActiveFilters({});
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
            const blockSelect = document.getElementById('blockFunction');
            blockSelect.innerHTML = '<option value="">-- –í—Å–µ –±–ª–æ–∫–∏ --</option>';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateStatsDisplay();
            showDataInfo();
            
            // –°–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ
            hideLoadingNotification();
            
            // –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º)
            updateSearchAvailability();
            
            showUploadStatus('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –£–¢–û –æ—á–∏—â–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.', 'success');
            console.log('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –£–¢–û –æ—á–∏—â–µ–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
        }

        function updateStatsDisplay() {
            document.getElementById('totalVitrinies').textContent = vitrinyData.length;
            document.getElementById('totalPositions').textContent = new Set(vitrinyData.map(i => i.position)).size;
            document.getElementById('totalSprav').textContent = spravData.length;
            document.getElementById('searchResults').textContent = currentResults.length;
        }
        
        function initializeDropdowns() {
            const blockSelect = document.getElementById('blockFunction');
            if (!blockSelect) return;
            
            if (vitrinyLoaded && !blockSelect.disabled) {
                const uniqueBlocks = [...new Set(vitrinyData.map(item => item.block).filter(Boolean))].sort();
                blockSelect.innerHTML = '<option value="">-- –í—Å–µ –±–ª–æ–∫–∏ --</option>';
                uniqueBlocks.forEach(block => {
                    const option = document.createElement('option');
                    option.value = block;
                    option.textContent = block;
                    blockSelect.appendChild(option);
                });
                console.log(`üìã –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –æ–ø—Ü–∏–∏ –±–ª–æ–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –£–¢–û: ${uniqueBlocks.length} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤`);
            } else if (blockSelect.disabled) {
                // –ï—Å–ª–∏ select –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–µ–∫—Å—Ç
                blockSelect.innerHTML = '<option value="">-- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –£–¢–û --</option>';
            }
        }
        
        function displayActiveFilters(filters) {
            const container = document.getElementById('activeFilters');
            const list = document.getElementById('filtersList');
            list.innerHTML = '';
            let hasFilters = false;
            for (const key in filters) {
                if (filters[key]) {
                    hasFilters = true;
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.textContent = `${key}: ${filters[key]}`;
                    list.appendChild(tag);
                }
            }
            container.style.display = hasFilters ? 'block' : 'none';
        }
        
        function showUploadStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            if (!statusDiv) return;
            statusDiv.textContent = message;
            statusDiv.className = `upload-status ${type}`;
            statusDiv.style.display = 'block';
            if (type !== 'loading') setTimeout(() => { statusDiv.style.display = 'none'; }, 5000);
        }

        function showDataInfo() {
            const uploadContainer = document.querySelector('.upload-container');
            if (!uploadContainer) return;

            let infoDiv = uploadContainer.querySelector('.data-info');
            if (infoDiv) {
                infoDiv.remove();
            }

            if (!vitrinyLoaded && !spravLoaded) return;

            infoDiv = document.createElement('div');
            infoDiv.className = 'data-info';
            
            let infoHTML = '<h4><i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–∞—Ö –£–¢–û</h4>';
            
            if (vitrinyLoaded) {
                const dateStr = vitrinyLoadDate ? vitrinyLoadDate.toLocaleString('ru-RU') : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                infoHTML += `<p style="margin-bottom: 5px;"><strong>–í–∏—Ç—Ä–∏–Ω—ã –£–¢–û:</strong> ${vitrinyFileName} (–∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${dateStr})</p>`;
            }
            if (spravLoaded) {
                 const dateStr = spravLoadDate ? spravLoadDate.toLocaleString('ru-RU') : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                infoHTML += `<p><strong>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –£–¢–û:</strong> ${spravFileName} (–∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${dateStr})</p>`;
            }
            
            infoDiv.innerHTML = infoHTML;
            uploadContainer.appendChild(infoDiv);
        }

        // --- –§–£–ù–ö–¶–ò–ò –≠–ö–°–ü–û–†–¢–ê ---
        function createExtendedExportData() {
            if (currentResults.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –£–¢–û –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.');
                return null;
            }

            const headers = [
                '–î–æ–ª–∂–Ω–æ—Å—Ç—å', '–°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è', '–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–û–ö–ó', 
                '–ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏', '–ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å', 
                '–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è', 
                '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 1', '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 2', '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 3', 
                '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 4', '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 5', '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 6',
                '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 7', '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 8', '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 9',
                '–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–µ–Ω—å 10',
                '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π', '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ 1', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ 2', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ 3'
            ];
            
            const data = [headers];

            currentResults.forEach(item => {
                const levels = item.departmentLevels || [];
                const notes = item.notes || [];
                
                const row = [
                    item.position || '',
                    item.systemName || '',
                    item.fullPositionName || '',
                    item.okz || '',
                    item.block || '',
                    item.belonging || '',
                    item.department || '',
                    levels[0] || '',
                    levels[1] || '',
                    levels[2] || '',
                    levels[3] || '',
                    levels[4] || '',
                    levels[5] || '',
                    levels[6] || '',
                    levels[7] || '',
                    levels[8] || '',
                    levels[9] || '',
                    item.comment || '',
                    item.note || '',
                    notes[0] || '',
                    notes[1] || '',
                    notes[2] || ''
                ];
                data.push(row);
            });

            return data;
        }

        function exportToExcel() {
            try {
                if (!xlsxAvailable) {
                    alert('Excel —ç–∫—Å–ø–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSV —ç–∫—Å–ø–æ—Ä—Ç.');
                    return;
                }
                
                const data = createExtendedExportData();
                if (!data) return;

                showLoadingNotification('–≠–∫—Å–ø–æ—Ä—Ç –£–¢–û –≤ Excel...', 3);
                updateLoadingProgress('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –£–¢–û...', 1);
                
                setTimeout(() => {
                    updateLoadingProgress('–°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞ –£–¢–û...', 2);
                    
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
                    const colWidths = [
                        {wch: 35}, {wch: 30}, {wch: 40}, {wch: 15}, {wch: 25}, {wch: 20}, {wch: 50},
                        {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25},
                        {wch: 25}, {wch: 25}, {wch: 25}, {wch: 40}, {wch: 40}, {wch: 30}, {wch: 30}, {wch: 30}
                    ];
                    
                    ws['!cols'] = colWidths;
                    
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –£–¢–û");
                    
                    setTimeout(() => {
                        updateLoadingProgress('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –£–¢–û...', 3);
                        
                        const filename = `export_uto_results_${new Date().toISOString().slice(0, 10)}.xlsx`;
                        XLSX.writeFile(wb, filename);
                        
                        setTimeout(() => {
                            showUploadStatus(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –£–¢–û –≤ Excel –∑–∞–≤–µ—Ä—à–µ–Ω. –§–∞–π–ª: ${filename}`, 'success');
                        }, 1000);
                    }, 500);
                }, 500);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –£–¢–û –≤ Excel:', error);
                showLoadingError(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –£–¢–û –≤ Excel: ${error.message}`);
            }
        }

        function exportToMoyOffice() {
            try {
                if (!xlsxAvailable) {
                    alert('–ú–æ–π–û—Ñ–∏—Å —ç–∫—Å–ø–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSV —ç–∫—Å–ø–æ—Ä—Ç.');
                    return;
                }
                
                const data = createExtendedExportData();
                if (!data) return;

                showLoadingNotification('–≠–∫—Å–ø–æ—Ä—Ç –£–¢–û –≤ –ú–æ–π–û—Ñ–∏—Å...', 3);
                updateLoadingProgress('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –£–¢–û...', 1);
                
                setTimeout(() => {
                    updateLoadingProgress('–°–æ–∑–¥–∞–Ω–∏–µ ODS —Ñ–∞–π–ª–∞ –£–¢–û...', 2);
                    
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    const colWidths = [
                        {wch: 35}, {wch: 30}, {wch: 40}, {wch: 15}, {wch: 25}, {wch: 20}, {wch: 50},
                        {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25}, {wch: 25},
                        {wch: 25}, {wch: 25}, {wch: 25}, {wch: 40}, {wch: 40}, {wch: 30}, {wch: 30}, {wch: 30}
                    ];
                    
                    ws['!cols'] = colWidths;

                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –£–¢–û");
                    
                    setTimeout(() => {
                        updateLoadingProgress('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –£–¢–û...', 3);
                        
                        const filename = `export_uto_results_${new Date().toISOString().slice(0, 10)}.ods`;
                        XLSX.writeFile(wb, filename, { bookType: 'ods' });
                        
                        setTimeout(() => {
                            showUploadStatus(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –£–¢–û –≤ –ú–æ–π–û—Ñ–∏—Å –∑–∞–≤–µ—Ä—à–µ–Ω. –§–∞–π–ª: ${filename}`, 'success');
                        }, 1000);
                    }, 500);
                }, 500);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –£–¢–û –≤ –ú–æ–π–û—Ñ–∏—Å:', error);
                showUploadStatus(`‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –£–¢–û –≤ –ú–æ–π–û—Ñ–∏—Å: ${error.message}`, 'error');
            }
        }

        console.log('üéâ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –£–¢–û —Å –ø–æ–ª–Ω–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!');
    </script>
</body>
</html>
